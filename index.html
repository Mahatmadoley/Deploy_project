<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dynamic Single-File Webpage</title>
  <meta name="description" content="A dynamic, responsive webpage built with only HTML, CSS, and vanilla JavaScript in a single file." />

  <!-- Favicon (SVG inline as data URI) -->
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="18" fill="%2300a3"/><path d="M22 65 L50 20 L78 65 Z" fill="white"/></svg>' />

  <style>
    :root {
      --bg: #0b0f14;
      --panel: #111827;
      --panel-2: #0f172a;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --brand: #22d3ee; /* cyan-400 */
      --brand-2: #a78bfa; /* violet-400 */
      --ring: rgba(34, 211, 238, 0.45);
      --ok: #10b981;
      --warn: #f59e0b;
      --danger: #ef4444;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    
    /* Light theme overrides */
    :root.light {
      --bg: #f8fafc;
      --panel: #ffffff;
      --panel-2: #f1f5f9;
      --text: #0f172a;
      --muted: #475569;
      --ring: rgba(124,58,237,.35);
      --shadow: 0 10px 30px rgba(2,6,23,.08);
    }

    /* Base reset */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font: 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: radial-gradient(1200px 700px at 80% -10%, rgba(34,211,238,.15), transparent 50%),
                  radial-gradient(900px 500px at -10% 0%, rgba(167,139,250,.15), transparent 45%),
                  var(--bg);
      scroll-behavior: smooth;
    }
    a { color: inherit; text-decoration: none; }
    img { max-width: 100%; display: block; }
    button { font: inherit; }

    /* Utilities */
    .container { width: min(1100px, 92%); margin: 0 auto; }
    .grid { display: grid; gap: 1rem; }
    .shadow { box-shadow: var(--shadow); }
    .card { background: linear-gradient(180deg, var(--panel), var(--panel-2)); border: 1px solid rgba(148,163,184,.15); border-radius: 1.2rem; padding: 1.2rem; }
    .chip { display:inline-flex; align-items:center; gap:.5rem; background: rgba(34,211,238,.12); border: 1px solid rgba(34,211,238,.3); color: var(--text); padding:.35rem .6rem; border-radius: 999px; font-size:.85rem; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 1px, 1px); white-space: nowrap; border: 0; }

    /* Navbar */
    header {
      position: sticky; top: 0; z-index: 50;
      backdrop-filter: saturate(180%) blur(12px);
      background: color-mix(in oklab, var(--bg) 70%, transparent);
      border-bottom: 1px solid rgba(148,163,184,.15);
    }
    .nav { display:flex; align-items:center; justify-content:space-between; padding:.75rem 0; }
    .brand { display:flex; align-items:center; gap:.6rem; font-weight:700; letter-spacing:.2px; }
    .brand svg { width:26px; height:26px; }
    .nav-links { display:flex; gap: .8rem; }
    .nav a { padding:.5rem .75rem; border-radius:.7rem; }
    .nav a:hover { background: rgba(148,163,184,.15); }
    .right-bar { display:flex; align-items:center; gap:.5rem; }
    .theme-toggle, .menu-toggle { border:1px solid rgba(148,163,184,.25); background: var(--panel); color:var(--text); border-radius:.8rem; padding:.5rem .7rem; cursor:pointer; }
    .menu-toggle { display:none; }

    /* Mobile menu */
    .mobile-menu { display:none; padding: .5rem 0 1rem; }
    .mobile-menu a { display:block; padding:.6rem .75rem; border-radius:.6rem; }
    .mobile-menu a:hover { background: rgba(148,163,184,.15); }

    /* Hero */
    .hero { padding: 5.5rem 0 3rem; display:grid; gap:2rem; align-items:center; }
    .hero .title { font-size: clamp(2rem, 4.5vw, 3rem); line-height:1.1; letter-spacing:-.02em; }
    .highlight { background: linear-gradient(90deg, var(--brand), var(--brand-2));
                 -webkit-background-clip: text; background-clip: text; color: transparent; }
    .sub { color: var(--muted); max-width: 65ch; }
    .cta-row { display:flex; flex-wrap:wrap; gap:.8rem; }
    .btn { display:inline-flex; align-items:center; gap:.5rem; padding:.75rem 1rem; border-radius:.9rem; border:1px solid rgba(148,163,184,.25); background: var(--panel); color:var(--text); cursor:pointer; }
    .btn.primary { background: linear-gradient(180deg, color-mix(in oklab, var(--brand) 35%, #fff 0%), var(--panel)); border-color: rgba(34,211,238,.45); }
    .btn:focus { outline: 3px solid var(--ring); outline-offset: 2px; }

    /* Sections */
    section { padding: 3rem 0; }
    section h2 { font-size: clamp(1.4rem, 2.8vw, 2rem); margin: 0 0 .6rem; }
    section p.lead { color: var(--muted); margin: 0 0 1.4rem; }

    /* Features grid */
    .features { grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
    .feature { transition: transform .18s ease, box-shadow .18s ease; border:1px solid rgba(148,163,184,.15); }
    .feature:hover { transform: translateY(-4px); box-shadow: 0 12px 26px rgba(0,0,0,.2); }

    /* Gallery with filters */
    .filters { display:flex; gap:.5rem; flex-wrap:wrap; margin-bottom:1rem; }
    .filters button { padding:.4rem .8rem; border-radius:.7rem; border:1px solid rgba(148,163,184,.3); background: var(--panel); color:var(--text); cursor:pointer; }
    .filters button.active { background: rgba(34,211,238,.12); border-color: rgba(34,211,238,.5); }
    .gallery { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
    .tile { position:relative; overflow:hidden; border-radius:1rem; border:1px solid rgba(148,163,184,.15); }
    .tile .label { position:absolute; inset:auto 8px 8px 8px; background: rgba(0,0,0,.45); color:#fff; padding:.3rem .5rem; border-radius:.5rem; font-size:.8rem; }

    /* Tabs */
    .tabs { display:flex; gap:.4rem; flex-wrap:wrap; }
    .tab-btn { padding:.5rem .8rem; border-radius:.6rem; border:1px solid rgba(148,163,184,.25); background: var(--panel); cursor:pointer; }
    .tab-btn[aria-selected="true"] { background: rgba(167,139,250,.15); border-color: rgba(167,139,250,.5); }
    .tab-panel { display:none; }
    .tab-panel[aria-hidden="false"] { display:block; }

    /* App card */
    .app { display:grid; gap:1rem; }
    .todo { display:grid; grid-template-columns: 1fr auto; gap:.6rem; }
    .todo input[type="text"] { padding:.65rem .75rem; border-radius:.7rem; border:1px solid rgba(148,163,184,.35); background: var(--panel-2); color:var(--text); }
    .list { display:grid; gap:.5rem; }
    .item { display:flex; align-items:center; gap:.6rem; justify-content:space-between; padding:.6rem .75rem; border:1px solid rgba(148,163,184,.25); border-radius:.7rem; background: var(--panel); }
    .item .meta { display:flex; align-items:center; gap:.6rem; }
    .badge { font-size:.75rem; padding:.15rem .45rem; border-radius:.5rem; border:1px solid rgba(148,163,184,.3); color: var(--muted); }

    /* Accordion */
    .accordion details { background: var(--panel); border:1px solid rgba(148,163,184,.2); border-radius:.9rem; padding:.6rem .8rem; }
    .accordion details + details { margin-top:.6rem; }
    .accordion summary { cursor:pointer; font-weight:600; }

    /* Footer */
    footer { padding: 2.5rem 0; color: var(--muted); border-top: 1px solid rgba(148,163,184,.15); }

    /* Responsive */
    @media (max-width: 820px) {
      .nav-links { display:none; }
      .menu-toggle { display:inline-flex; }
      .hero { padding-top: 4.2rem; }
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a class="brand" href="#top" aria-label="Home">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 16L12 4l8 12H4Z" stroke="currentColor" stroke-width="2"/></svg>
        <span>Vanilla<span class="highlight">Magic</span></span>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <a href="#features">Features</a>
        <a href="#gallery">Gallery</a>
        <a href="#playground">Playground</a>
        <a href="#faq">FAQ</a>
        <a href="#contact">Contact</a>
      </nav>
      <div class="right-bar">
        <button class="theme-toggle" id="themeToggle" aria-pressed="false" title="Toggle theme">üåó Theme</button>
        <button class="menu-toggle" id="menuToggle" aria-expanded="false" aria-controls="mobileMenu" title="Menu">‚ò∞</button>
      </div>
    </div>
    <div class="container mobile-menu" id="mobileMenu" hidden>
      <a href="#features">Features</a>
      <a href="#gallery">Gallery</a>
      <a href="#playground">Playground</a>
      <a href="#faq">FAQ</a>
      <a href="#contact">Contact</a>
    </div>
  </header>

  <main id="top">
    <section class="hero container">
      <div class="card shadow">
        <span class="chip" aria-hidden="true">No frameworks ‚Ä¢ No build step</span>
        <h1 class="title">A dynamic, responsive site powered by <span class="highlight">pure HTML, CSS & JavaScript</span>.</h1>
        <p class="sub">This single <code>index.html</code> packs a theme switcher, tabs, filters, a localStorage todo app, an accessible accordion, a modal contact form, and more ‚Äî all with clean, modern styling.</p>
        <div class="cta-row">
          <a href="#playground" class="btn primary">Open Playground</a>
          <button class="btn" id="openAbout">Quick Intro</button>
        </div>
      </div>
    </section>

    <section id="features" class="container">
      <h2>Features</h2>
      <p class="lead">Handy UI patterns built from scratch. Inspect the code, tweak values, and learn how everything works.</p>
      <div class="grid features">
        <article class="feature card">
          <h3>Theme System</h3>
          <p>Light/Dark with persistence and <code>prefers-color-scheme</code> support.</p>
        </article>
        <article class="feature card">
          <h3>Tabs & Filters</h3>
          <p>Switch content and filter items using ARIA-compliant controls.</p>
        </article>
        <article class="feature card">
          <h3>Local Storage</h3>
          <p>Keep your tasks between visits with a tiny state manager.</p>
        </article>
        <article class="feature card">
          <h3>Accessible Widgets</h3>
          <p>Accordion, modal dialog, keyboard navigation and focus traps.</p>
        </article>
      </div>
    </section>

    <section id="gallery" class="container">
      <h2>Filterable Gallery</h2>
      <p class="lead">Use the filters to show only the category you like. All images are CSS gradients ‚Äî no downloads needed.</p>

      <div class="filters" role="tablist" aria-label="Gallery filters">
        <button class="active" data-filter="all" role="tab" aria-selected="true">All</button>
        <button data-filter="nature" role="tab" aria-selected="false">Nature</button>
        <button data-filter="tech" role="tab" aria-selected="false">Tech</button>
        <button data-filter="abstract" role="tab" aria-selected="false">Abstract</button>
      </div>

      <div class="grid gallery" id="galleryGrid" aria-live="polite">
        <!-- Tiles generated by JS -->
      </div>
    </section>

    <section id="playground" class="container">
      <h2>Playground</h2>
      <p class="lead">Switch tabs and try the mini app. Everything happens in-place with small, readable scripts.</p>

      <div class="tabs" role="tablist" aria-label="Playground tabs">
        <button class="tab-btn" role="tab" aria-selected="true" aria-controls="tab-1" id="tabbtn-1">To‚ÄëDo</button>
        <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-2" id="tabbtn-2">Text Utils</button>
        <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-3" id="tabbtn-3">Random Tips</button>
      </div>

      <div class="card tab-panel" id="tab-1" role="tabpanel" aria-labelledby="tabbtn-1" aria-hidden="false">
        <div class="app">
          <form id="todoForm" class="todo" autocomplete="off">
            <label class="sr-only" for="todoInput">Add a task</label>
            <input id="todoInput" type="text" placeholder="Add a task and press Enter" required />
            <button class="btn" type="submit">Add</button>
          </form>
          <div class="list" id="todoList" aria-live="polite"></div>
          <div>
            <button class="btn" id="clearDone">Clear Completed</button>
            <button class="btn" id="exportTasks">Export JSON</button>
            <input type="file" id="importTasks" accept="application/json" style="display:none" />
            <button class="btn" id="importBtn">Import JSON</button>
          </div>
        </div>
      </div>

      <div class="card tab-panel" id="tab-2" role="tabpanel" aria-labelledby="tabbtn-2" aria-hidden="true">
        <div class="app">
          <textarea id="textArea" rows="6" style="width:100%; padding:.8rem; border-radius:.8rem; border:1px solid rgba(148,163,184,.35); background:var(--panel-2); color:var(--text);" placeholder="Paste or type some text‚Ä¶"></textarea>
          <div class="cta-row">
            <button class="btn" id="toUpper">UPPERCASE</button>
            <button class="btn" id="toLower">lowercase</button>
            <button class="btn" id="toTitle">Title Case</button>
            <button class="btn" id="copyText">Copy</button>
          </div>
          <p id="textStats" class="muted"></p>
        </div>
      </div>

      <div class="card tab-panel" id="tab-3" role="tabpanel" aria-labelledby="tabbtn-3" aria-hidden="true">
        <div class="app">
          <p id="tipBox">Click the button for a helpful tip.</p>
          <button class="btn" id="newTip">New Tip</button>
        </div>
      </div>
    </section>

    <section id="faq" class="container">
      <h2>FAQ</h2>
      <p class="lead">Common questions about this single-file project.</p>
      <div class="accordion">
        <details>
          <summary>Is any framework used?</summary>
          <p>No. Everything is built with semantic HTML, modern CSS, and vanilla JS ‚Äî in one file.</p>
        </details>
        <details>
          <summary>How is state persisted?</summary>
          <p>Small helpers wrap <code>localStorage</code> for the todo list and theme preferences.</p>
        </details>
        <details>
          <summary>Is it accessible?</summary>
          <p>Interactive components include ARIA roles, focus styles, keyboard support, and proper labels.</p>
        </details>
      </div>
    </section>

    <section id="contact" class="container">
      <h2>Contact</h2>
      <p class="lead">Open the dialog and send a message. The modal traps focus and validates your input.</p>
      <button class="btn primary" id="openModal">Open Contact Form</button>
    </section>
  </main>

  <footer>
    <div class="container">
      <p>¬© <span id="year"></span> VanillaMagic. Built with ‚ù§ using no frameworks.</p>
    </div>
  </footer>

  <!-- Modal Dialog -->
  <dialog id="contactDialog" style="border:none; border-radius:1rem; padding:0; background:transparent;">
    <form method="dialog" class="card shadow" style="min-width:min(560px, 92vw);">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:1rem; margin-bottom:.5rem;">
        <h3 style="margin:.2rem 0 0;">Send a Message</h3>
        <button type="button" id="closeModal" class="btn" aria-label="Close">‚úï</button>
      </div>
      <div class="grid" style="gap:.8rem;">
        <label>
          <span class="sr-only">Your name</span>
          <input id="nameInput" name="name" type="text" placeholder="Your name" required style="width:100%; padding:.7rem .8rem; border-radius:.7rem; border:1px solid rgba(148,163,184,.35); background:var(--panel-2); color:var(--text);" />
        </label>
        <label>
          <span class="sr-only">Email</span>
          <input id="emailInput" name="email" type="email" placeholder="you@example.com" required style="width:100%; padding:.7rem .8rem; border-radius:.7rem; border:1px solid rgba(148,163,184,.35); background:var(--panel-2); color:var(--text);" />
        </label>
        <label>
          <span class="sr-only">Message</span>
          <textarea id="msgInput" name="message" rows="5" placeholder="Your message" required style="width:100%; padding:.7rem .8rem; border-radius:.7rem; border:1px solid rgba(148,163,184,.35); background:var(--panel-2); color:var(--text);"></textarea>
        </label>
      </div>
      <div style="display:flex; justify-content:flex-end; gap:.6rem; margin-top:1rem;">
        <button class="btn" value="cancel">Cancel</button>
        <button class="btn primary" id="sendBtn" value="default">Send</button>
      </div>
      <p id="formStatus" style="color:var(--muted); margin-top:.8rem; font-size:.95rem;"></p>
    </form>
  </dialog>

  <template id="tileTemplate">
    <figure class="tile">
      <div class="img" style="aspect-ratio: 4/3; background: linear-gradient(135deg, var(--c1), var(--c2));"></div>
      <figcaption class="label"></figcaption>
    </figure>
  </template>

  <script>
    // ===== Utilities =====
    const $ = (q, ctx=document) => ctx.querySelector(q);
    const $$ = (q, ctx=document) => Array.from(ctx.querySelectorAll(q));

    const store = {
      get(key, fallback) { try { return JSON.parse(localStorage.getItem(key)) ?? fallback; } catch { return fallback; }},
      set(key, value) { localStorage.setItem(key, JSON.stringify(value)); }
    };

    // ===== Theme System =====
    (function initTheme() {
      const saved = store.get('theme', 'auto');
      const prefers = window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
      const mode = saved === 'auto' ? prefers : saved;
      if (mode === 'light') document.documentElement.classList.add('light');
      $('#themeToggle').setAttribute('aria-pressed', String(mode === 'light'));

      $('#themeToggle').addEventListener('click', () => {
        document.documentElement.classList.toggle('light');
        const isLight = document.documentElement.classList.contains('light');
        $('#themeToggle').setAttribute('aria-pressed', String(isLight));
        store.set('theme', isLight ? 'light' : 'dark');
      });
    })();

    // ===== Navbar: mobile menu =====
    (function initMenu(){
      const btn = $('#menuToggle');
      const menu = $('#mobileMenu');
      btn.addEventListener('click', () => {
        const open = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!open));
        menu.hidden = open;
      });
      // Close on nav click
      $$('#mobileMenu a').forEach(a => a.addEventListener('click', () => {
        btn.setAttribute('aria-expanded', 'false');
        menu.hidden = true;
      }));
    })();

    // ===== Hero: modal intro =====
    (function introDialog(){
      const about = `This page demonstrates several interactive components without any frameworks. Explore the code to see simple patterns you can reuse.`;
      $('#openAbout').addEventListener('click', () => alert(about));
    })();

    // ===== Footer year =====
    $('#year').textContent = new Date().getFullYear();

    // ===== Gallery with filters =====
    (function gallery(){
      const colors = {
        nature: ['#16a34a', '#22c55e', '#65a30d', '#84cc16'],
        tech: ['#0ea5e9', '#22d3ee', '#6366f1', '#06b6d4'],
        abstract: ['#f59e0b', '#a78bfa', '#ef4444', '#f43f5e']
      };
      const grid = $('#galleryGrid');
      const template = $('#tileTemplate');

      const items = Array.from({length: 18}, (_,i) => {
        const keys = Object.keys(colors);
        const category = keys[i % keys.length];
        const [c1, c2] = [colors[category][i % 4], colors[category][(i+1)%4]];
        return { id:i+1, category, label: category.toUpperCase() + ' #' + (i+1), c1, c2 };
      });

      function render(filter='all'){
        grid.innerHTML='';
        const list = filter==='all' ? items : items.filter(x => x.category===filter);
        for (const it of list){
          const node = template.content.firstElementChild.cloneNode(true);
          node.querySelector('.img').style.setProperty('--c1', it.c1);
          node.querySelector('.img').style.setProperty('--c2', it.c2);
          node.querySelector('.label').textContent = it.label;
          node.setAttribute('data-category', it.category);
          grid.appendChild(node);
        }
      }
      render();

      const btns = $$('.filters button');
      btns.forEach(b => b.addEventListener('click', () => {
        btns.forEach(x => { x.classList.remove('active'); x.setAttribute('aria-selected','false'); });
        b.classList.add('active');
        b.setAttribute('aria-selected','true');
        render(b.dataset.filter);
      }));
    })();

    // ===== Tabs =====
    (function tabs(){
      const buttons = $$('.tab-btn');
      const panels = $$('.tab-panel');

      function show(i){
        buttons.forEach((b,idx)=>{
          const on = idx===i;
          b.setAttribute('aria-selected', String(on));
          panels[idx].setAttribute('aria-hidden', String(!on));
        });
      }
      buttons.forEach((b,i)=> b.addEventListener('click', ()=> show(i)) );
      // keyboard support
      buttons.forEach((b,i)=> b.addEventListener('keydown', (e)=>{
        if (['ArrowRight','ArrowLeft','Home','End'].includes(e.key)){
          e.preventDefault();
          let idx=i;
          if (e.key==='ArrowRight') idx = (i+1)%buttons.length;
          if (e.key==='ArrowLeft') idx = (i-1+buttons.length)%buttons.length;
          if (e.key==='Home') idx = 0;
          if (e.key==='End') idx = buttons.length-1;
          buttons[idx].focus();
          show(idx);
        }
      }));
    })();

    // ===== To‚ÄëDo App =====
    (function todo(){
      const listEl = $('#todoList');
      const input = $('#todoInput');
      const form = $('#todoForm');
      const clearBtn = $('#clearDone');
      const exportBtn = $('#exportTasks');
      const importBtn = $('#importBtn');
      const importFile = $('#importTasks');

      let tasks = store.get('tasks', []);

      function save(){ store.set('tasks', tasks); }

      function render(){
        listEl.innerHTML = '';
        if (!tasks.length){ listEl.innerHTML = '<p style="color:var(--muted)">No tasks yet. Add one above.</p>'; return; }
        tasks.forEach((t,idx)=>{
          const row = document.createElement('div');
          row.className = 'item';
          row.innerHTML = `
            <div class="meta">
              <input type="checkbox" ${t.done?'checked':''} aria-label="Mark done" />
              <span contenteditable class="task" style="outline:none">${t.text.replace(/</g,'&lt;')}</span>
              <span class="badge">${new Date(t.created).toLocaleDateString()}</span>
            </div>
            <div style="display:flex; gap:.4rem;">
              <button class="btn" data-act="up" title="Move up">‚ñ≤</button>
              <button class="btn" data-act="down" title="Move down">‚ñº</button>
              <button class="btn" data-act="del" title="Delete">üóëÔ∏è</button>
            </div>`;
          // Events
          const [chk, textEl] = [row.querySelector('input[type=checkbox]'), row.querySelector('.task')];
          chk.addEventListener('change', ()=>{ t.done = chk.checked; save(); });
          textEl.addEventListener('input', ()=>{ t.text = textEl.textContent.trim(); save(); });
          row.addEventListener('click', (e)=>{
            const act = e.target.getAttribute('data-act');
            if (!act) return;
            if (act==='del'){ tasks.splice(idx,1); render(); save(); }
            if (act==='up' && idx>0){ [tasks[idx-1],tasks[idx]]=[tasks[idx],tasks[idx-1]]; render(); save(); }
            if (act==='down' && idx<tasks.length-1){ [tasks[idx+1],tasks[idx]]=[tasks[idx],tasks[idx+1]]; render(); save(); }
          });
          listEl.appendChild(row);
        });
      }

      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        const text = input.value.trim();
        if (!text) return;
        tasks.push({ text, done:false, created: Date.now() });
        input.value='';
        render(); save();
      });

      clearBtn.addEventListener('click', ()=>{ tasks = tasks.filter(t=>!t.done); render(); save(); });

      exportBtn.addEventListener('click', ()=>{
        const blob = new Blob([JSON.stringify(tasks, null, 2)], {type:'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'tasks.json';
        a.click();
        URL.revokeObjectURL(a.href);
      });

      importBtn.addEventListener('click', ()=> importFile.click());
      importFile.addEventListener('change', async ()=>{
        const file = importFile.files[0];
        if (!file) return;
        const text = await file.text();
        try { tasks = JSON.parse(text); render(); save(); }
        catch { alert('Invalid JSON'); }
        importFile.value = '';
      });

      render();
    })();

    // ===== Text Utils =====
    (function textUtils(){
      const area = $('#textArea');
      const stats = $('#textStats');
      const up = $('#toUpper');
      const low = $('#toLower');
      const title = $('#toTitle');
      const copy = $('#copyText');

      const updateStats = () => {
        const s = area.value.trim();
        const words = s ? s.split(/\s+/).length : 0;
        stats.textContent = `${s.length} characters ‚Ä¢ ${words} words`;
      };
      area.addEventListener('input', updateStats);
      up.addEventListener('click', ()=>{ area.value = area.value.toUpperCase(); updateStats(); });
      low.addEventListener('click', ()=>{ area.value = area.value.toLowerCase(); updateStats(); });
      title.addEventListener('click', ()=>{
        area.value = area.value.toLowerCase().replace(/\b(\w)/g, (m)=> m.toUpperCase());
        updateStats();
      });
      copy.addEventListener('click', async ()=>{
        await navigator.clipboard.writeText(area.value);
        copy.textContent = 'Copied!'; setTimeout(()=> copy.textContent='Copy', 1200);
      });
    })();

    // ===== Random Tips =====
    (function tips(){
      const tips = [
        'Press / to quickly focus search inputs (try it here!).',
        'Use localStorage to persist lightweight app state across visits.',
        'Reduce layout shift by setting width/height or aspect-ratio on images.',
        'Prefer CSS grid for complex, responsive layouts with fewer media queries.',
        'Use :has() and :where() selectors in modern browsers to simplify CSS.',
        'Keep JS small and declarative; use data-* attributes for clean hooks.'
      ];
      const el = $('#tipBox');
      $('#newTip').addEventListener('click', ()=>{
        const i = Math.floor(Math.random() * tips.length);
        el.textContent = tips[i];
      });
      // keyboard: focus text area with /
      window.addEventListener('keydown', (e)=>{
        if (e.key === '/' && document.activeElement.tagName !== 'TEXTAREA' && document.activeElement.tagName !== 'INPUT'){
          e.preventDefault();
          const ta = $('#textArea');
          if (ta) { ta.focus(); }
        }
      });
    })();

    // ===== Modal Contact Form with focus trap =====
    (function modal(){
      const dlg = $('#contactDialog');
      const open = $('#openModal');
      const close = $('#closeModal');
      const send = $('#sendBtn');
      const status = $('#formStatus');
      const inputs = ['#nameInput','#emailInput','#msgInput'].map(q => $(q));

      function trap(e){
        if (e.key !== 'Tab') return;
        const focusables = dlg.querySelectorAll('button, [href], input, textarea');
        const first = focusables[0], last = focusables[focusables.length - 1];
        if (e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
        else if (!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
      }

      open.addEventListener('click', ()=>{ dlg.showModal(); inputs[0].focus(); dlg.addEventListener('keydown', trap); });
      close.addEventListener('click', ()=>{ dlg.close(); dlg.removeEventListener('keydown', trap); status.textContent=''; });

      send.addEventListener('click', (e)=>{
        e.preventDefault();
        const [name,email,msg] = inputs.map(i=> i.value.trim());
        const ok = name && /.+@.+\..+/.test(email) && msg.length>4;
        if (!ok){ status.textContent = 'Please fill all fields with a valid email.'; status.style.color='var(--warn)'; return; }
        status.textContent = 'Message sent! (Simulated)';
        status.style.color = 'var(--ok)';
        setTimeout(()=>{ dlg.close(); inputs.forEach(i=> i.value=''); status.textContent=''; }, 900);
      });
    })();
  </script>
</body>
</html>
